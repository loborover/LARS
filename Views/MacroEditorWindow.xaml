<Window x:Class="LARS.Views.MacroEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="LARS â€” Visual Macro Editor"
        Width="1200" Height="800"
        MinWidth="900" MinHeight="600"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource LarsWindow}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="54"/>
            <RowDefinition Height="2*"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="*" MinHeight="40"/>
            <RowDefinition Height="32"/>
        </Grid.RowDefinitions>

        <!-- ===== ìƒë‹¨ íˆ´ë°” ===== -->
        <Border Grid.Row="0" Background="{StaticResource HeaderGradientBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <Grid Margin="16,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- íƒ€ì´í‹€ -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,16,0">
                    <TextBlock Text="ðŸ§©" FontSize="20" Margin="0,0,8,0" VerticalAlignment="Center"/>
                    <TextBlock Text="VME" FontSize="16" FontWeight="Bold"
                               Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- ë§¤í¬ë¡œ ì„ íƒ (ComboBox) -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,16,0">
                    <TextBlock Text="ë§¤í¬ë¡œ:" VerticalAlignment="Center" Margin="0,0,6,0"
                               Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"/>
                    <ComboBox ItemsSource="{Binding SavedMacroItems}"
                              SelectedItem="{Binding SelectedMacroItem, Mode=TwoWay}"
                              Width="180" VerticalAlignment="Center" FontSize="12"/>
                    <TextBox Text="{Binding MacroName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Width="140" VerticalAlignment="Center" FontSize="12" Margin="6,0,0,0"
                             ToolTip="í˜„ìž¬ ë§¤í¬ë¡œ ì´ë¦„ (íŽ¸ì§‘ ê°€ëŠ¥)"/>
                </StackPanel>

                <!-- Target Documents -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,16,0">
                    <TextBlock Text="ì ìš© ë¬¸ì„œ:" VerticalAlignment="Center" Margin="0,0,6,0"
                               Foreground="{StaticResource TextSecondaryBrush}" FontSize="12"/>
                    <ComboBox ItemsSource="{Binding TargetDocumentTypes}"
                              SelectedItem="{Binding SelectedTargetDoc, Mode=TwoWay}"
                              Width="120" VerticalAlignment="Center" FontSize="12"/>
                </StackPanel>

                <!-- ìš°ì¸¡ ë²„íŠ¼ ê·¸ë£¹ -->
                <StackPanel Grid.Column="4" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Style="{StaticResource SecondaryButton}" Content="ðŸ“‚ ë§¤í¬ë¡œ ë¶ˆëŸ¬ì˜¤ê¸°"
                            Command="{Binding LoadMacroCommand}" Margin="0,0,6,0" FontSize="11"/>
                    <Button Style="{StaticResource SecondaryButton}" Content="ðŸ’¾ ì €ìž¥"
                            Command="{Binding SaveMacroCommand}" Margin="0,0,6,0" FontSize="11"/>
                    <Button Style="{StaticResource PrimaryButton}" Content="â–¶ ì‹¤í–‰"
                            Command="{Binding RunMacroCommand}" FontSize="11"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- ===== Raw / Processed ì´ì¤‘ ë·° (ìœ„ìª½) ===== -->
        <Border Grid.Row="1" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="5"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Raw View (ì›ë³¸) -->
                <DockPanel Grid.Column="0">
                    <Border DockPanel.Dock="Top" Background="{StaticResource SecondaryDarkBrush}" Padding="8,4">
                        <Grid>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ“„ Raw View (ì›ë³¸)" FontWeight="Bold" FontSize="12"
                                           Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding RawFilePath, FallbackValue=''}" FontSize="10"
                                           Foreground="{StaticResource TextMutedBrush}" Margin="8,0,0,0"
                                           VerticalAlignment="Center" MaxWidth="250" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>
                            <Button Style="{StaticResource SecondaryButton}" Content="ðŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°"
                                    Command="{Binding LoadRawFileCommand}" HorizontalAlignment="Right"
                                    FontSize="10" Padding="8,2"/>
                        </Grid>
                    </Border>
                    <DataGrid ItemsSource="{Binding RawData}" AutoGenerateColumns="True"
                              IsReadOnly="True"
                              Background="{StaticResource PrimaryDarkBrush}"
                              Foreground="{StaticResource TextPrimaryBrush}"
                              RowBackground="{StaticResource CardBrush}"
                              AlternatingRowBackground="{StaticResource SecondaryDarkBrush}"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="{StaticResource BorderBrush}"/>
                </DockPanel>

                <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch"
                              Background="{StaticResource BorderBrush}"/>

                <!-- Processed View (ê°€ê³µ ê²°ê³¼) -->
                <DockPanel Grid.Column="2">
                    <Border DockPanel.Dock="Top" Background="{StaticResource SecondaryDarkBrush}" Padding="8,4">
                        <TextBlock Text="ðŸ“Š Processed View (ê°€ê³µ ê²°ê³¼)" FontWeight="Bold" FontSize="12"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                    </Border>
                    <DataGrid ItemsSource="{Binding PreviewData}" AutoGenerateColumns="True"
                              IsReadOnly="True"
                              Background="{StaticResource PrimaryDarkBrush}"
                              Foreground="{StaticResource TextPrimaryBrush}"
                              RowBackground="{StaticResource CardBrush}"
                              AlternatingRowBackground="{StaticResource SecondaryDarkBrush}"
                              GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="{StaticResource BorderBrush}"/>
                </DockPanel>
            </Grid>
        </Border>

        <!-- GridSplitter: ì´ì¤‘ë·° â†” ë§¤í¬ë¡œ ì„¤ê³„ ì˜ì—­ -->
        <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch"
                      Background="{StaticResource BorderBrush}"/>

        <!-- ===== ë©”ì¸ 3ë¶„í•  ì˜ì—­ (ë§¤í¬ë¡œ ì„¤ê³„) ===== -->
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280"/>
            </Grid.ColumnDefinitions>

            <!-- ì¢Œì¸¡: ë¸”ë¡ íŒ”ë ˆíŠ¸ -->
            <Border Grid.Column="0" BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,1,0"
                    Background="{StaticResource SecondaryDarkBrush}">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="ë¸”ë¡ íŒ”ë ˆíŠ¸" FontWeight="Bold" FontSize="13"
                               Foreground="{StaticResource TextPrimaryBrush}" Margin="12,12,12,4"/>
                    <TextBlock DockPanel.Dock="Top" Text="í´ë¦­í•˜ì—¬ ìº”ë²„ìŠ¤ì— ì¶”ê°€" FontSize="11"
                               Foreground="{StaticResource TextMutedBrush}" Margin="12,0,12,8"/>

                    <ListBox ItemsSource="{Binding AvailableBlockTypes}"
                             Background="Transparent" BorderThickness="0"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{StaticResource CardBrush}" CornerRadius="6"
                                        Padding="10,8" Margin="6,3" Cursor="Hand"
                                        BorderBrush="{StaticResource BorderBrush}" BorderThickness="1">
                                    <Border.InputBindings>
                                        <MouseBinding MouseAction="LeftClick"
                                                      Command="{Binding DataContext.AddBlockCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                      CommandParameter="{Binding}"/>
                                    </Border.InputBindings>
                                    <StackPanel>
                                        <TextBlock Text="{Binding DisplayName}" FontWeight="SemiBold" FontSize="12"
                                                   Foreground="{StaticResource TextPrimaryBrush}"/>
                                        <TextBlock Text="{Binding Category}" FontSize="10"
                                                   Foreground="{StaticResource TextMutedBrush}" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>

            <!-- ì¤‘ì•™: ìº”ë²„ìŠ¤ (íŒŒì´í”„ë¼ì¸ ì‹œê°í™”) -->
            <Border Grid.Column="1" Background="{StaticResource PrimaryDarkBrush}">
                <DockPanel>
                    <Border DockPanel.Dock="Top" Padding="12,8"
                            Background="{StaticResource SecondaryDarkBrush}"
                            BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
                        <Grid>
                            <TextBlock Text="ðŸ“ íŒŒì´í”„ë¼ì¸ ìº”ë²„ìŠ¤" FontWeight="Bold" FontSize="13"
                                       Foreground="{StaticResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                            <Button Style="{StaticResource SecondaryButton}" Content="ðŸ—‘ï¸ ì „ì²´ ì´ˆê¸°í™”" 
                                    Command="{Binding ClearAllCommand}" HorizontalAlignment="Right" FontSize="11"/>
                        </Grid>
                    </Border>

                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                        <ItemsControl ItemsSource="{Binding Nodes}" Margin="16">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <Border CornerRadius="8" Padding="16,12" MinWidth="140"
                                                Cursor="Hand" Background="{StaticResource CardBrush}"
                                                BorderBrush="{StaticResource BorderBrush}" BorderThickness="2" Margin="4">
                                            <Border.InputBindings>
                                                <MouseBinding MouseAction="LeftClick"
                                                              Command="{Binding DataContext.SelectNodeCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                              CommandParameter="{Binding}"/>
                                            </Border.InputBindings>
                                            <StackPanel HorizontalAlignment="Center">
                                                <TextBlock Text="{Binding Label}" FontWeight="Bold" FontSize="13"
                                                           Foreground="{StaticResource TextPrimaryBrush}" TextAlignment="Center"/>
                                                <TextBlock Text="{Binding Type}" FontSize="10"
                                                           Foreground="{StaticResource TextMutedBrush}" TextAlignment="Center" Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                        <TextBlock Text="â†’" FontSize="24" VerticalAlignment="Center"
                                                   Foreground="{StaticResource TextMutedBrush}" Margin="4,0"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </DockPanel>
            </Border>

            <!-- ìš°ì¸¡: ì†ì„± íŒ¨ë„ -->
            <Border Grid.Column="2" BorderBrush="{StaticResource BorderBrush}" BorderThickness="1,0,0,0"
                    Background="{StaticResource SecondaryDarkBrush}">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="ðŸ“‹ ì†ì„± íŒ¨ë„" FontWeight="Bold" FontSize="13"
                               Foreground="{StaticResource TextPrimaryBrush}" Margin="12,12,12,8"/>

                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="12,0,12,12">
                            <TextBlock Text="ì„ íƒëœ ë¸”ë¡:" FontSize="11" Foreground="{StaticResource TextMutedBrush}" Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding SelectedNode.Label, FallbackValue='(ì—†ìŒ)'}" FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}" FontSize="14" Margin="0,0,0,12"/>

                            <TextBlock Text="ì†ì„± (key=value í˜•ì‹):" FontSize="11"
                                       Foreground="{StaticResource TextMutedBrush}" Margin="0,0,0,4"/>
                            <TextBox Text="{Binding SelectedNodePropsText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                     AcceptsReturn="True" TextWrapping="Wrap"
                                     MinHeight="120" MaxHeight="200" FontFamily="Consolas" FontSize="12"
                                     VerticalScrollBarVisibility="Auto"/>

                            <Button Style="{StaticResource SecondaryButton}" Content="âœ… ì†ì„± ì ìš©"
                                    Command="{Binding ApplyPropsCommand}" Margin="0,8,0,0"/>

                            <Separator Margin="0,12"/>

                            <Button Style="{StaticResource SecondaryButton}" Content="ðŸ—‘ï¸ ì„ íƒ ë¸”ë¡ ì‚­ì œ"
                                    Command="{Binding DeleteSelectedBlockCommand}" Margin="0,4,0,0"
                                    Foreground="IndianRed"/>
                        </StackPanel>
                    </ScrollViewer>
                </DockPanel>
            </Border>
        </Grid>

        <!-- ===== ìƒíƒœ ë°” ===== -->
        <Border Grid.Row="4" Background="{StaticResource SecondaryDarkBrush}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
            <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center" Margin="16,0"
                       FontSize="12" Foreground="{StaticResource TextSecondaryBrush}"/>
        </Border>
    </Grid>
</Window>
